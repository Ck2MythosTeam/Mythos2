# Replace heir
faction_draconic_heir = {
	type = realm_characters_plus
	exclusive = yes
	
	warning_level = 0.7
	
	cancel_on_leader_death = yes
	
	# Plotter scope
	potential = {
		prisoner = no
		independent = no
		is_adult = yes
		culture = draconic
		primary_title = { holy_order = no }
		NOT = { trait = incapable }
		OR = {
			NOT = { has_dlc = "Zeus" }
			is_voter = no
			liege = { 
				OR = {
					is_council_content = no
					NOT = { primary_title = { has_law = war_voting_power_1 } }
					#has_council = no
				}
			}
		}
		trait = dragon
		
		NOT = { has_character_modifier = faction_draconic_heir_ultimatum_timer }
	}
	
	# Target scope
	allow = {
		prisoner = no
		NOT = { has_assigned_minor_title = title_forced_heir }
		OR = {
			government = draconic_feudal_government
			government = draconic_tribal_government
			government = draconic_governorship
		}
		current_heir = {
			NOT = {
				trait = dragon
			}
		}
	}
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			mercenary = no
			OR = {
				NOT = { has_dlc = "Zeus"}
				is_voter = no
				is_nomadic = yes
				is_tribal = yes
				liege = { 
					OR = {
						is_council_content = no
						NOT = { primary_title = { has_law = war_voting_power_1 } }
						#has_council = no
					}
				}
			}
			OR = {
				is_nomadic = no
				NOT = {
					clan_opinion = { who = LIEGE value = 0 }
				}
			}
		}
		FROM = {
			NOT = { current_heir = { character = ROOT } }
		}
	}
	
	# AI creation weight
	chance = {
		factor = 4
		
		modifier = {
			factor = 0
			NOT = { FROM = { can_hold_title = title_forced_heir } }
		}
		
		modifier = {
			factor = 0.2
			FROM = { pacifist = yes }
		}
		
		# Exclude characters trying to replace leige or succession law
		modifier = {
			factor = 0
			FROM = {
				OR = {
					leads_faction = faction_claimant
					in_faction = faction_claimant 
					leads_faction = faction_succ_seniority
					in_faction = faction_succ_seniority
					leads_faction = faction_succ_primogeniture
					in_faction = faction_succ_primogeniture
					leads_faction = faction_succ_gavelkind
					in_faction = faction_succ_gavelkind
					leads_faction = faction_succ_feudal_elective
					in_faction = faction_succ_feudal_elective
					leads_faction = faction_independence
					in_faction = faction_independence
					leads_faction = faction_antiking
					in_faction = faction_antiking
					leads_faction = faction_overthrow
					in_faction = faction_overthrow
					leads_faction = faction_powerful_vassal_takeover
					in_faction = faction_powerful_vassal_takeover
				}
			}
		}
		
		modifier = {
			factor = 0
			FROM = {
				OR = {
					prisoner = yes
					has_character_modifier = in_seclusion
				}
			}
		}
		
		modifier = {
			factor = 0
			current_heir = {
				character = FROM
			}
		}
		
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			holder_scope = {
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					FROM = {
						primary_title = {
							de_jure_liege_or_above = PREVPREV
						}
					}
					any_claimant = {
						religion = FROM
						opinion_diff = {
							first = FROM
							second = LIEGE
							value = 10 # I like the Claimant more than the current ruler
							as_if_liege = yes
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 0
			FROM = { preparing_invasion = yes }
		}
		
		modifier = {
			factor = 0.4
			ROOT = {
				current_heir = {
					trait = dragonborn
				}
			}
		}
		
		modifier = {
			factor = 0.8
			ROOT = {
				current_heir = {
					reverse_opinion = { who = FROM value = 0 }
				}
			}
		}
		modifier = {
			factor = 0.7
			ROOT = {
				current_heir = {
					reverse_opinion = { who = FROM value = 25 }
				}
			}
		}
		modifier = {
			factor = 0.6
			ROOT = {
				current_heir = {
					reverse_opinion = { who = FROM value = 50 }
				}
			}
		}
		modifier = {
			factor = 0.5
			ROOT = {
				current_heir = {
					reverse_opinion = { who = FROM value = 75 }
				}
			}
		}
		modifier = {
			factor = 0.5
			ROOT = {
				current_heir = {
					reverse_opinion = { who = FROM value = 100 }
				}
			}
		}
		modifier = {
			factor = 1.5
			ROOT = {
				current_heir = {
					NOT = { reverse_opinion = { who = FROM value = -24 } }
				}
			}
		}
		modifier = {
			factor = 2
			ROOT = {
				current_heir = {
					NOT = { reverse_opinion = { who = FROM value = -49 } }
				}
			}
		}
		modifier = {
			factor = 4
			ROOT = {
				current_heir = {
					NOT = { reverse_opinion = { who = FROM value = -74 } }
				}
			}
		}
		modifier = {
			factor = 2
			ROOT= {
				current_heir = {
					NOT = { reverse_opinion = { who = FROM value = -99 } }
				}
			}
		}
		modifier = {
			factor = 2
			FROM = {
				is_foe = ROOT
			}
		}
		modifier = {
			factor = 4
			ROOT = {
				current_heir = {
					FROM = {
						is_foe = PREV
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				current_heir = {
					FROM = {
						is_friend = PREV
					}
				}
			}
		}
		modifier = {
			factor = 5
			trait = ambitious
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.2
			FROM = { 
				OR = {
					trait = slow
					trait = dull
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		
		# Exclude characters trying to replace leige or succession law
		modifier = {
			factor = 0
			FROM = {
				OR = {
					leads_faction = faction_claimant
					in_faction = faction_claimant 
					leads_faction = faction_succ_seniority
					in_faction = faction_succ_seniority
					leads_faction = faction_succ_primogeniture
					in_faction = faction_succ_primogeniture
					leads_faction = faction_succ_gavelkind
					in_faction = faction_succ_gavelkind
					leads_faction = faction_succ_feudal_elective
					in_faction = faction_succ_feudal_elective
					leads_faction = faction_independence
					in_faction = faction_independence
					leads_faction = faction_antiking
					in_faction = faction_antiking
					leads_faction = faction_overthrow
					in_faction = faction_overthrow
					leads_faction = faction_powerful_vassal_takeover
					in_faction = faction_powerful_vassal_takeover
				}
			}
		}
		
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				trait = incapable
				is_adult = no
				is_landed = no
				preparing_invasion = yes
			}
		}
		
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = {
					character = ROOT
				}
			}
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		
		modifier = {
			factor = 0
			has_character_modifier = faction_draconic_heir_ultimatum_timer
		}
		
		modifier = {
			factor = 0
			NOT = { opinion = { who = FROM value = -40 } }
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		
		modifier = {
			factor = 0
			liege = { 
				NOT = { year = 1350 }
				primary_title = { is_tribal_type_title = yes }
				culture = ROOT
				religion = ROOT
			}
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		
		modifier = {
			factor = 0
			has_opinion_modifier = {
				who = LIEGE
				modifier = opinion_coerced_into_leaving_faction
			}
		}
		
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = -40 }
			is_voter = no
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}

		modifier = {
			factor = 0
			opinion = { who = LIEGE value = -20 }
			is_voter = yes
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		
		modifier = {
			factor = 0.2
			NOT = { trait = dragon }
		}
		
		modifier = {
			factor = 0.2
			pacifist = yes
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		
		modifier = {
			factor = 1000
			has_opinion_modifier = {
				who = FROM
				modifier = opinion_coerced_into_joining_faction
			}
		}
		
		modifier = {
			factor = 1.5
			FROMFROM = {
				current_heir = {
					NOT = { reverse_opinion = { who = ROOT value = -25 } }
				}
			}
		}
		modifier = {
			factor = 2
			FROMFROM = {
				current_heir = {
					NOT = { reverse_opinion = { who = ROOT value = -50 } }
				}
			}
		}
		modifier = {
			factor = 4
			FROMFROM = {
				current_heir = {
					NOT = { reverse_opinion = { who = ROOT value = -75 } }
				}
			}
		}
		modifier = {
			factor = 2
			FROMFROM = {
				current_heir = {
					ROOT = {
						is_foe = PREV
					}
				}
			}
		}
		modifier = {
			factor = 0.01
			trait = content
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0.01
			trait = imbecile
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0.1
			trait = inbred
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0.1
			trait = craven
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0.2
			OR = {
				trait = slow
				trait = dull
			}
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
	}
	
	success = {
		FROM = {
			has_assigned_minor_title = title_forced_heir
		}
		has_minor_title = title_forced_heir
	}
	
	abort = {
		FROM = {
			has_assigned_minor_title = title_forced_heir
		}
		NOT = { has_minor_title = title_forced_heir }
	}
	
	abort_effect = {
	}
	
	effect = {
		FROM = {
			any_faction_backer = {
				faction = faction_draconic_heir
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
			reverse_opinion = {
				modifier = opinion_forced_heir
				who = ROOT
			}
		}
	}
}